\documentclass{ltjsarticle}
\usepackage{luatexja}
\usepackage{bcprules}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{tikz}
\usetikzlibrary{matrix, positioning}
\begin{document}

\theoremstyle{definition}
\newtheorem{defn}{定義}
\newtheorem{thm}{定理}
\newtheorem{lem}{補題}
\newtheorem{rem}{注意}
\newtheorem{cor}{系}
\newtheorem{ex}{例}
\renewcommand{\proofname}{\bf{証明}}

\title{_}
\author{
アドバイザー名: Jacques Garrigue
学生番号: 321701183
氏名: 田中 一成
}
% \maketitle

% 構成案
% 
% 型システムを論理体系とみなすために必要な事実とは
% 合流性 (等式の判定のため)
% 正規性 (?, 不等式の場合にかんがえてみるべき?)
% - equiv. canonicity?
% Subject Reductionをいれるか？
% lambda cubeをみせるか？
% いくつかの主張を型で書いてみるとか？
% - False型 (任意の主張がせいりつする)
% Cocに対応するtheoryを構成するべきか？
% Cocのモデルは必要か？
%  - Scottの方法がつかえるか？
% rewritingについてどれだけのべるか？
% - あまり必要ない？
% - completionはheuristicなので説明しづらい
% - Universal Algebraくらいは述べてもいいかな？
%   - theoryの記述につかえる
% 数学的な記述 vs BNF
% Polymorphic typeの整合性
% - 集合論での矛盾 (Gilard)
% - System Fのモチベーション
%   - Prop as Type
% Intuitionistic logicの歴史はいる?
% 
% 適切なReductionを入れることが重要であると私はおもっている...
% - directed homotopy? (わかってないので書かない)
% - よくかんがえたらこの問題意識はcompletion由来かも?

\begin{abstract}
\end{abstract}

% いらないのでは？
\section{記号等}
初めに簡約関係と呼ばれる一般の$2$項関係について論じる. 考えている集合$A$とその上の$2$項関係$\rightarrow \subset A \times A$を固定する.ここでそれぞれ,
$\xrightarrow{n}$を$\rightarrow$を$n$回合成した関係,
$\leftrightarrow$を$\rightarrow$の対称閉包,
$\xrightarrow{+}$を$\rightarrow$の推移閉包,
$\xrightarrow{=}$を$\rightarrow$の反射閉包,
$\overset{*}{\rightarrow}$を$\rightarrow$の推移反射閉包,
$\overset{+}{\leftrightarrow}$を$\rightarrow$の推移対称閉包,
$\overset{*}{\leftrightarrow}$を$\rightarrow$の推移対称反射閉包とする.
また$(a, b) \in \rightarrow$を$a \rightarrow b$と書く.

\begin{defn}
$\rightarrow$が合流性を持つとは,任意の$y_{1},y_{2},x \in A$について$y_1 \overset{*}{\leftarrow} x \overset{*}{\rightarrow} y_2$ならば, $y_1 \overset{*}{\rightarrow} z \overset{*}{\leftarrow} y_2$となる$z \in A$が存在することを言い, 停止するとは無限列$a_0 \rightarrow a_1 \rightarrow a_2 \rightarrow \cdots$が$A$に存在しないことを言う. さらに$x \in A$が正規形であるとは, $x \rightarrow y$となる$y \in A$が存在しないことを言う.
\end{defn}

また停止性の非自明な言い換えとしてwell foundnessとよばれるものがある.

\begin{defn}
$\rightarrow$がwell foundedであるとは, 以下の条件が同値であることをいう. ただし$P$は任意の述語を表している.
 \begin{itemize}
  \item 任意の$x \in A$について, $x \xrightarrow{+} y$となる全ての$y \in A$に対して$P(y)$ならば$P(x)$
  \item 任意の$z \in A$について$P(z)$
 \end{itemize}
\end{defn}

\begin{thm}
 停止性とwell foundnessは同値である.
\end{thm}

\begin{proof}
 必要性を示す. 任意の$w \in A$について$P(w):= \text{無限列} w \rightarrow w_1 \rightarrow \cdots \text{は存在しない}$と置く. 任意の$x \xrightarrow{+} y$について$P(y)$が成立するとすると, $x$から始まる無限列は起こり得ない. したがって$P(x)$が成立する. $\rightarrow$がwell foundedであることより, 任意の$z \in A$に対して$P(z)$, すなわち$\rightarrow$の停止性が従う.
 
 十分性を背理法により示す. 任意の$x \xrightarrow{+} y$について$P(y)$ならば$P(x)$かつ, ある$z \in A$が存在して$P(z)$が成立しないと仮定する. 前半の主張の対偶をとると, 任意の$x \in A$に対して$P(x)$が成立しないならば, ある$y \in A$で$x \xrightarrow{+} y$かつ$P(y)$が成立しないものが存在することになる. この主張を用いて$z$から始まる無限列を構成することができる.
\end{proof}

\begin{rem}
帰納的に定義された(有限)木構造に対して, 自然な順序が存在する.
このときその順序に対して, well foundnessを常に適用できるが, これを断りなく帰納法と呼ぶ.
\end{rem}

%\section{型理論とは}
% 仰々しい?
% 1

\section{ラムダ計算}
この節ではCoCの基礎となる(型なし)ラムダ計算のいくつかの事実を述べる.

\begin{defn}
 ラムダ項$t$とは, 以下のBNFで定義される木である. $v$は可算濃度の集合$V$の元を意味している.
 \[
 t := v | \lambda v. t | t t
 \]
\end{defn}

BNFでの定義と同値なものが以下である.

\begin{defn}
 ラムダ項の集合$\Lambda$とは, 以下の条件を満たす最小の集合のことをいう.
 \begin{itemize}
  \item $V \subset \Lambda$
  \item 任意の$v \in V$, $M \in \Lambda$について, $\lambda v. M \in \Lambda$
  \item 任意の$M \in \Lambda$, $N \in \Lambda$について, $M N \in \Lambda$
 \end{itemize}
\end{defn}

ただし, ここではラムダ項そのものの定義ではなくラムダ項の集合を定義している. 以下では記述を簡潔にするため, 構文の定義としてBNFでの表記を用いることとする.

ラムダ計算のシステムは計算として機能するための作用を持つ. そのうちの最も本質的なものが$\beta$簡約と呼ばれている.

\begin{defn}
 $\beta$簡約$\rightarrow_{\beta}$とは$\Lambda$の上の$2$項関係であり, 以下の条件を満たす最小の関係のことをいう.
 \begin{itemize}
  \item 任意の$v \in V$, $M, N \in \Lambda$について, $(\lambda v. M) N \rightarrow_\beta M[N/v]$
  \item 任意の$v \in V$, $N_1, N_2 \in \Lambda$について, $N_1 \rightarrow_\beta N_2$ならば$(\lambda v. N_1) \rightarrow_\beta (\lambda v. N_2)$
  \item 任意の$M, N_1, N_2 \in \Lambda$について, $N_1 \rightarrow_\beta N_2$ならば$M N_1 \rightarrow_\beta M N_2$かつ$N_1 M \rightarrow_\beta N_2 M$
 \end{itemize}
 ただし, ここで$M[N/v]$とは代入と呼ばれる操作を表している. 代入とはラムダ項$M \in \Lambda$の中に表れる$v \in V$をすべてラムダ項$N \in \Lambda$に置きかえるということである.
\end{defn}

ここで述べた代入という操作を正確に記述するために, de brujin indexとよばれるものを導入する.
集合$V$は変数の集合を表しており, 我々の状況では$V := \mathbb{N}$として問題ないため, 以下ではそのようにする.

また, ラムダ項の定義を修正し以下のようにする.

\begin{defn}
 \[
 t := v | \lambda. t | t t
 \]
\end{defn}

\begin{defn}[de brujin index]
 写像 $s \colon \Lambda \times \mathbb{N} \times \mathbb{N} \rightarrow \Lambda$を任意のラムダ項$M$, 自然数$n, c$に対して, 以下のように帰納的に定義する.
 
\[
  s (M, n, c) := \begin{cases}
    M & (M \in V \text{かつ} M < c) \\
    M + n & (M \in V \text{かつ} M \geq c) \\
    \lambda. s (N, n, c + 1) & (M = \lambda. N) \\
    s (N_1, n, c) s (N_2, n, c) & (M = N_1 N_2)
  \end{cases}
\]
 この写像$s$を用いて, ラムダ項$M, N \in \Lambda$, 変数$v \in V$に対する代入を以下のように帰納的に定義する.
 
\[
 M[N/v] := \begin{cases}
    N & (M = v) \\
    M - 1 & (M \in V \text{かつ} v < M) \\
    M & (M \in V \text{かつ} v \geq M) \\
    \lambda. M' [s (N, 1, 0)/(v + 1)] & (M = \lambda. M') \\
    N_1[N/v] N_2[N/v] & (M = N_1 N_2)
  \end{cases}
\]
\end{defn}

$\beta$簡約の定義も修正する.

\begin{defn}
 $\beta$簡約$\rightarrow_{\beta}$とは$\Lambda$の上の$2$項関係であり, 以下の条件を満たす最小の関係のことをいう.
 \begin{itemize}
  \item 任意の$M, N \in \Lambda$について, $(\lambda. M) N \rightarrow_\beta M[N/0]$
  \item 任意の$N_1, N_2 \in \Lambda$について, $N_1 \rightarrow_\beta N_2$ならば$(\lambda. N_1) \rightarrow_\beta (\lambda. N_2)$
  \item 任意の$M, N_1, N_2 \in \Lambda$について, $N_1 \rightarrow_\beta N_2$ならば$M N_1 \rightarrow_\beta M N_2$かつ$N_1 M \rightarrow_\beta N_2 M$
 \end{itemize}
\end{defn}

\begin{ex}[$K$ コンビネータ]
 $V$を文字列の集合とする. このとき $x, y \in V$, $z, w \in \Lambda$に対して以下の様な例が考えられる.
 \[
 (\lambda x. \lambda y. x) z w \rightarrow_{\beta} (\lambda y. z) w \rightarrow_{\beta} z
 \]
 これをde brujin indexで表わすと, $z, w \in \Lambda$に対して以下のようになる.
 \[
 (\lambda. \lambda. 1) z w \rightarrow_{\beta} (\lambda. 1)[z/0] w = (\lambda. 1[s (z, 1, 0)/1]) w \rightarrow_{\beta} 1[s (z, 1, 0)/1][w/0] = s (z, 1, 0)[w/0] = z
 \]
ここでの$\lambda. \lambda. 1$を$K$コンビネータという.
\end{ex}

ラムダ計算の基本的な性質として合流性がある.

\begin{thm}[Church Rosserの定理]\label{CR}
 $\beta$簡約$\rightarrow_{\beta}$は合流性を持つ.
\end{thm}

以下では定理\ref{CR}を示すために必要な準備を行う. まずparallel reductionと呼ばれる2項関係を定義する.

\begin{defn}
 parallel reduction$\rightarrow_{p}$とは$\Lambda$の上の$2$項関係であり, 以下の条件を満たす最小の関係のことをいう.
 \begin{description}
  \item[P1] 任意の$x, y \in V$について, $x = y$ならば$x \rightarrow_{p} y$
  \item[P2] 任意の$t, s \in \Lambda$について, $t \rightarrow_{p} s$ならば$\lambda. t \rightarrow_{p} \lambda. s$
  \item[P3] 任意の$t_1, t_2, s_1, s_2 \in \Lambda$について,
        $t_1 \rightarrow_{p} s_1$かつ$t_2 \rightarrow_{p} s_2$ならば$t_1 t_2 \rightarrow_{p} s_1 s_2$
  \item[P4] 任意の$t_1, t_2, s_1, s_2 \in \Lambda$について,
        $t_1 \rightarrow_{p} s_1$かつ$t_2 \rightarrow_{p} s_2$ならば$(\lambda. t_1) t_2 \rightarrow_{p} s_1[s_2/0]$
 \end{description}
\end{defn}

\begin{lem}\label{spp}
 代入はparallel reduction$\rightarrow_{p}$を保つ. すなわち$t_1, t_2, s_1, s_2 \in \Lambda$, $u \in V$に対して, $t_1 \rightarrow_{p} t_2$かつ$s_1 \rightarrow_{p} s_2$ならば$s_1[t_1/u] \rightarrow_{p} s_2[t_2/u]$.
\end{lem}

\begin{proof}
 $\rightarrow_{p}$の定義による帰納法を用いる. P4%TODO: fix
のみが非自明なので, その場合のみを示す.
 すなわち$p, q, t_1, t_2, s_1, s_2 \in \Lambda$に対して,
$p \rightarrow_{p} q$, $t_1 \rightarrow_{p} s_1$かつ $t_2 \rightarrow_{p} s_2$ならば$((\lambda. t_1) t_2) [p / s] \rightarrow_{p} (s_1 [s_2 / 0] [q / s])$を示す.
 
 代入を交換すると, 以下のような等式が成立する
 \[
 s_1 [s_2 / 0][q / s] = s_1 [s(q, 1, 0) / (s + 1)][s_2 [q / s] / 0]
 \]
 ことに注意する. 上の等式により, $t_1$に対しての帰納法の仮定を適用することができて, 主張が成立する.
\end{proof}

parallel reductionと$\beta$簡約の関係は以下のようになる.

\begin{lem}
 $\rightarrow_{\beta} \subset \rightarrow_{p} \subset \overset{*}{\rightarrow_{\beta}}$
\end{lem}

\begin{proof}
 前半は項のサイズによる帰納法を用いて示される. 後半は$\rightarrow_{p}$の定義による帰納法を用いて示される.
\end{proof}

\begin{cor}
 $\overset{*}{\rightarrow_{p}} = \overset{*}{\rightarrow_{\beta}}$
\end{cor}

上記の系と推移反射閉包を取る操作が合流性を保つことに注意すると, 定理\ref{CR}の言い換えが得られる.

\begin{thm}[Church Rosserの定理]\label{CR'}
 $\rightarrow_{p}$は合流性を持つ.
\end{thm}

\begin{proof}
 証明は\cite{高橋正子1991計算論}の71ページに従った.
任意の$M \in \Lambda$に対して, ある$N_M \in \Lambda$が存在し, 任意の$L \in \Lambda$に対して, $M \rightarrow_p L$ならば$L \rightarrow_p N_M$という主張を証明する.

$M \in \Lambda$を固定する. この$M$に対する帰納法を用いて主張を示す.

$M \in V$の場合, $N_M := M$とすれば, 任意の$L \in \Lambda$に対して, P1でのみ$M \rightarrow_p L$が与えられるため, このとき$L = M$. すなわち, $L \rightarrow_p N_M$.

$M = \lambda. M_0$となる$M_0 \in \Lambda$が存在する場合は, $N_M := \lambda. N_{M_0}$とするとよい.
実際, 任意の$L \in \Lambda$に対して, $M \rightarrow_p L$と仮定する.
このとき, ある$L_0 \in \Lambda$が存在して, $L = \lambda. L_0$, $M_0 \rightarrow_p L_0$となる.
なぜならば, $M \rightarrow_p L$となるときには, P2で$M \rightarrow_p L$が構成されることしか有り得ないためである.
すると帰納法の仮定より$L_0 \rightarrow_p N_{M_0}$, 再びP2により$L \rightarrow_p N_M$.

$M = (\lambda. M_0) M_1$となる$M_0, M_1 \in \Lambda$が存在する場合, $N_M := N_{M_0}[N_{M_1}/0]$とするとよい. 実際, 任意の$L \in \Lambda$に対して, $M \rightarrow_p L$と仮定する. このとき, $M \rightarrow_p L$の与えられ方はP3あるいはP4のいずれかとなる.
 
 P3のとき$L = (\lambda. L_0) L_1$となる$L_0, L_1 \in \Lambda$が存在し, $M_0 \rightarrow_p L_0$かつ$M_1 \rightarrow_p L_1$でなければならない. 帰納法の仮定により$L_0 \rightarrow_p N_{M_0}$かつ$L_1 \rightarrow_p N_{M_1}$となっているため, P4により$(\lambda. L_0) L_1 \rightarrow_p N_{M_0} [N_{M_1}/0]$が得られる.
 
 P4のとき$L = L_0 [L_1/0]$となる$L_0, L_1 \in \Lambda$が存在し, $M_0 \rightarrow_p L_0$かつ$M_1 \rightarrow_p L_1$でなければならない. 帰納法の仮定により$L_0 \rightarrow_p N_{M_0}$かつ$L_1 \rightarrow_p N_{M_1}$となっているため, 補題\ref{spp}より$L_0 [L_1/0] \rightarrow_p N_{M_0} [N_{M_1}/0]$が得られる.
 
最後に$M = M_0 M_1$となる$M_0, M_1 \in \Lambda$が存在する場合, $N_M := N_{M_0} N_{M_1}$とするとよい. これも自明である.
\end{proof}

\section{Calculus of Construction}
この節ではCoCの定義および停止性の証明を与える. 型なしラムダ計算における議論とは平行していることに注意されたい.
型なしの場合におけるラムダ項に対応するものとしてpseudotermと呼ばれるものを定義する.

\begin{defn}
 pseudoterm $p$とは, 以下のBNFで定義される木である. $v$は可算濃度の集合$V$の元を意味している.
 \[
 p := v | \lambda v \colon p. p | \Pi v \colon p. p | p p | \star | \square
 \]
 また, $P$をpseudotermの集合とする.
\end{defn}

\begin{defn}
 $\beta$簡約$\rightarrow_{\beta}$とは$P$の上の$2$項関係であり, 以下の条件を満たす最小の関係のことをいう.
 \begin{itemize}
  \item 任意の$v \in V$, $M, T, N \in P$について, $(\lambda v \colon T. M) N \rightarrow_\beta M[N/v]$
  \item 任意の$v \in V$, $N_1, N_2, M \in P$について, $N_1 \rightarrow_\beta N_2$ならば$\lambda v \colon M. N_1 \rightarrow_\beta \lambda v \colon M. N_2$
  \item 任意の$M, N_1, N_2 \in P$について, $N_1 \rightarrow_\beta N_2$ならば$M N_1 \rightarrow_\beta M N_2$かつ$N_1 M \rightarrow_\beta N_2 M$
 \end{itemize}
 ただし, ここで$M[N/v]$は$P$上で定義される代入のことである.
\end{defn}

TODO

型づけ規則とよばれる自然演繹のシステムが存在し, それも含めての計算体系としてCoCは定義される. 習慣に従って, ここでは文脈$\Gamma$を用いた記法を用いている.

\begin{defn}
 CoCにおける型づけ規則は以下のものからなる.
\infrule[Ax]{
}{
 \vdash \star \colon \square
}
\infrule[var]{
 \Gamma \vdash T \colon \star / \square
 \andalso \Gamma, v \colon T \vdash v \colon T
 \andalso $v$は$\Gamma$に出現しないもの
}{
 \Gamma, v \colon T \vdash v \colon T
}
\infrule[weak]{
 \Gamma \vdash T \colon \star / \square
 \andalso \Gamma \vdash M \colon U
 \andalso $v$は$\Gamma$に出現しないもの
 %             \RightLabel{$v$は$\Gamma$に出現しないもの}
}{
 \Gamma, v \colon T \vdash M \colon U
}
\infrule[$\Pi$]{
 \Gamma \vdash T \colon \star / \square
 \andalso \Gamma, v \colon T \vdash U \colon s
 \andalso s = \star, \square
}{
 \Gamma \vdash \Pi v \colon T . U \colon s
}
\infrule[$\lambda$]{
  \Gamma, v \colon T \vdash M \colon U
  \andalso \Gamma \vdash \Pi v \colon T . U \colon \star / \square
}{
  \Gamma \vdash \lambda v \colon T . M \colon \Pi v \colon T . U
}
\infrule[app]{
  \Gamma \vdash M \colon \Pi v \colon T . U
  \andalso \Gamma \vdash N \colon T
}{
  \Gamma \vdash M N \colon U[N/v]
}
\infrule[conv]{
  \Gamma \vdash N \colon T
  \andalso \Gamma \vdash U \colon \star / \square
  \andalso T \overset{*}{\leftrightarrow}_\beta U
}{
  \Gamma \vdash M \colon U
}
 % \item[conv] \begin{prooftree}
 %              \AxiomC{$\Gamma \vdash N \colon T$}
 %              \AxiomC{$\Gamma \vdash U \colon \star / \square$}
 %              \RightLabel{$T \overset{*}{\leftrightarrow}_\beta U$}
 %              \BinaryInfC{$\Gamma \vdash M \colon U$}
 %             \end{prooftree}
\end{defn}

型つきの計算規則のもとでは, 型がつく項のみが考える対象となる. 実際, 型づけ可能な項については$\beta$簡約の上で停止性が成立する.

\begin{thm}
 型づけ可能な$P$上の$\beta$簡約$\rightarrow_{\beta}|_T$は停止性を持つ.
\end{thm}
\begin{proof}
 証明は\cite{geuvers1994short}に従った.
\end{proof}

%\section{論理体系としてのCoC}
% SN と CR -> type jugdement が decidable.
% domain のなかで証明列をながめると?
% CoCでないと扱えないようなStatementの例とは? : Proposition の合成?
% 3

\section{まとめ}
% 結論がよわいような...
% 1

\section{謝辞}

\bibliography{bib}
\bibliographystyle{junsrt}
\end{document}
